<UserControl x:Class="TestCaseEditorApp.MVVM.Domains.Shared.Views.DocumentScrapperView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:conv="clr-namespace:TestCaseEditorApp.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    
    <UserControl.Resources>
        <conv:BoolToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <conv:InvertedBoolToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0" Background="#F0F0F0" Padding="10" Margin="5">
            <StackPanel>
                <TextBlock Text="{Binding Title}" FontSize="16" FontWeight="Bold" Margin="0,0,0,5"/>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Workspace: " FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding CurrentWorkspaceName}" Margin="5,0"/>
                    <TextBlock Text="Jama Project: " FontWeight="SemiBold" Margin="10,0,0,0"/>
                    <TextBlock Text="{Binding CurrentJamaProjectName}" Margin="5,0"/>
                </StackPanel>
                <TextBlock Text="{Binding StatusMessage}" Margin="0,5,0,0" FontStyle="Italic"/>
                
                <!-- Progress Bar -->
                <ProgressBar Grid.Row="1" Height="20" Margin="0,5" 
                           Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}"
                           Value="{Binding BackgroundScanProgress}" 
                           Maximum="{Binding BackgroundScanTotal}"/>
            </StackPanel>
        </Border>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="5" HorizontalAlignment="Left">
            <Button Content="Refresh Attachments" 
                    Command="{Binding RefreshAttachmentsCommand}" 
                    IsEnabled="{Binding HasJamaProject}"
                    Margin="5" Padding="10,5"/>
            <Button Content="Cancel Scan" 
                    Command="{Binding CancelScanCommand}" 
                    IsEnabled="{Binding IsScanning}"
                    Margin="5" Padding="10,5"/>
            <Button Content="Import Selected Requirements" 
                    Command="{Binding ImportSelectedRequirementsCommand}" 
                    Margin="5" Padding="10,5"/>
        </StackPanel>

        <!-- Results Tabs -->
        <TabControl Grid.Row="2" Margin="5">
            <!-- Attachments Tab -->
            <TabItem Header="Found Attachments">
                <Grid>
                    <ListView ItemsSource="{Binding FoundAttachments}" 
                              ScrollViewer.HorizontalScrollBarVisibility="Auto">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="ID" DisplayMemberBinding="{Binding Id}" Width="80"/>
                                <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="200"/>
                                <GridViewColumn Header="File Name" DisplayMemberBinding="{Binding FileName}" Width="150"/>
                                <GridViewColumn Header="Size" DisplayMemberBinding="{Binding Size}" Width="80"/>
                                <GridViewColumn Header="Created Date" DisplayMemberBinding="{Binding CreatedDate}" Width="120"/>
                                <GridViewColumn Header="Mime Type" DisplayMemberBinding="{Binding MimeType}" Width="120"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </TabItem>

            <!-- Parsing Results Tab -->
            <TabItem Header="Parsing Results">
                <Grid>
                    <ListBox ItemsSource="{Binding ParsingResults}"
                             ScrollViewer.HorizontalScrollBarVisibility="Auto"
                             ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" TextWrapping="Wrap" Margin="5"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </TabItem>

            <!-- Extracted Requirements Tab -->
            <TabItem Header="Extracted Requirements">
                <Grid>
                    <ListView ItemsSource="{Binding ExtractedRequirements}"
                              ScrollViewer.HorizontalScrollBarVisibility="Auto">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="ID" DisplayMemberBinding="{Binding Id}" Width="80"/>
                                <GridViewColumn Header="Text" DisplayMemberBinding="{Binding Text}" Width="300"/>
                                <GridViewColumn Header="Type" DisplayMemberBinding="{Binding RequirementType}" Width="100"/>
                                <GridViewColumn Header="Priority" DisplayMemberBinding="{Binding Priority}" Width="80"/>
                                <GridViewColumn Header="Source" DisplayMemberBinding="{Binding SourceDocument}" Width="150"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- No Jama Project Overlay -->
        <Border Grid.Row="0" Grid.RowSpan="3" 
                Background="#80000000" 
                Visibility="{Binding HasJamaProject, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
            <Border Background="White" Padding="30" 
                    VerticalAlignment="Center" HorizontalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="No Jama Project Associated" 
                               FontSize="18" FontWeight="Bold" 
                               HorizontalAlignment="Center" Margin="0,0,0,10"/>
                    <TextBlock Text="Document scrapping requires a workspace with an associated Jama project." 
                               TextWrapping="Wrap" 
                               HorizontalAlignment="Center" 
                               MaxWidth="300" 
                               TextAlignment="Center"/>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</UserControl>