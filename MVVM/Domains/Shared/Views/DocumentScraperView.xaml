<UserControl x:Class="TestCaseEditorApp.MVVM.Domains.Shared.Views.DocumentScraperView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:conv="clr-namespace:TestCaseEditorApp.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    
    <UserControl.Resources>
        <conv:BoolToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <conv:InvertedBoolToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0" Background="{StaticResource Brush.Background.Header}" Padding="16" Margin="0">
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="ðŸ”" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding Title}" 
                               FontSize="{StaticResource FontSize.H1}" 
                               FontWeight="SemiBold" 
                               Foreground="{StaticResource Brush.Accent.Primary}"
                               VerticalAlignment="Center"/>
                </StackPanel>
                <TextBlock Text="{Binding StatusMessage}" 
                           FontSize="{StaticResource FontSize.Body}"
                           Foreground="{StaticResource Brush.Text.Secondary}" 
                           Margin="0,0,0,8"/>
                
                <!-- Elapsed Time Display -->
                <StackPanel Orientation="Horizontal" 
                           Visibility="{Binding ShowElapsedTime, Converter={StaticResource BooleanToVisibilityConverter}}"
                           Margin="0,0,0,8">
                    <TextBlock Text="â±ï¸" FontSize="14" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBlock Text="Elapsed Time: " 
                               FontSize="{StaticResource FontSize.Caption}"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource Brush.Text.Primary}" 
                               VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding ElapsedTime}" 
                               FontSize="{StaticResource FontSize.Caption}"
                               FontWeight="Bold"
                               Foreground="{StaticResource Brush.Accent.Primary}" 
                               VerticalAlignment="Center" 
                               Margin="4,0"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Workspace: " 
                               FontSize="{StaticResource FontSize.Caption}"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource Brush.Text.Primary}"/>
                    <TextBlock Text="{Binding CurrentWorkspaceName}" 
                               FontSize="{StaticResource FontSize.Caption}"
                               Foreground="{StaticResource Brush.Text.Secondary}"
                               Margin="4,0,16,0"/>
                    <TextBlock Text="Jama Project: " 
                               FontSize="{StaticResource FontSize.Caption}"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource Brush.Text.Primary}"/>
                    <TextBlock Text="{Binding CurrentJamaProjectName}" 
                               FontSize="{StaticResource FontSize.Caption}"
                               Foreground="{StaticResource Brush.Text.Secondary}"
                               Margin="4,0"/>
                </StackPanel>
                
                <!-- Progress Bar -->
                <ProgressBar Grid.Row="1" Height="6" Margin="0,8,0,0" 
                           Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}"
                           Value="{Binding BackgroundScanProgress}" 
                           Maximum="{Binding BackgroundScanTotal}"
                           Background="{StaticResource Brush.Background.Menu}"
                           Foreground="{StaticResource Brush.Accent.Primary}"
                           BorderThickness="0"/>
            </StackPanel>
        </Border>

        <!-- Document Selection and Action Controls -->
        <Border Grid.Row="1" Background="{StaticResource Brush.Background.Surface}" Padding="16,12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                -- Document Selection Row -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,12">
                    <TextBlock Text="Select:" 
                               FontSize="{StaticResource FontSize.Body}"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource Brush.Text.Primary}" 
                               VerticalAlignment="Center" 
                               Margin="0,0,8,0"/>
                    
                    <ComboBox ItemsSource="{Binding FoundAttachments}" 
                              SelectedItem="{Binding SelectedAttachment}"
                              DisplayMemberPath="Name"
                              MinWidth="200" 
                              Margin="0,0,12,0"
                              VerticalAlignment="Center">
                        <ComboBox.Style>
                            <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding FoundAttachments.Count}" Value="0">
                                        <Setter Property="IsEnabled" Value="False"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ComboBox.Style>
                    </ComboBox>
                    
                    <Button Content="ðŸ“ Open" 
                            Command="{Binding ScanSelectedAttachmentCommand}" 
                            IsEnabled="{Binding CanScanSelectedAttachment}"
                            Style="{StaticResource ActionButton.Secondary}"
                            Margin="0,0,12,0" 
                            Padding="12,8"
                            FontSize="{StaticResource FontSize.Body}"/>
                            
                    <!-- Smart Toggle Button - TESTING VISIBILITY -->
                    <Button Content="TEST SMART TOGGLE" 
                            Command="{Binding SmartToggleCommand}" 
                            IsEnabled="True"
                            Padding="16,8"
                            FontWeight="Bold"
                            MinWidth="250"
                            Background="Red"
                            Foreground="White"
                            BorderThickness="3"
                            BorderBrush="Yellow"
                            FontSize="16"/>
                </StackPanel>
                
                <!-- Traditional Individual Buttons (for advanced users) - HIDDEN BUT FUNCTIONALITY PRESERVED -->
                <!--
                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" Opacity="0.7">
                    <TextBlock Text="Advanced:" 
                               FontSize="{StaticResource FontSize.Caption}"
                               Foreground="{StaticResource Brush.Text.Secondary}"
                               VerticalAlignment="Center" 
                               Margin="0,0,8,0"/>
                    <Button Content="ðŸ” Search" 
                            Command="{Binding RefreshAttachmentsCommand}" 
                            IsEnabled="{Binding HasJamaProject}"
                            Style="{StaticResource ActionButton.Secondary}"
                            Margin="0,0,6,0" 
                            Padding="8,6"
                            FontSize="{StaticResource FontSize.Caption}"/>
                    <Button Content="ðŸ“„ Scan" 
                            Command="{Binding ScanSelectedAttachmentCommand}" 
                            IsEnabled="{Binding CanScanSelectedAttachment}"
                            Style="{StaticResource ActionButton.Secondary}"
                            Margin="0,0,6,0" 
                            Padding="8,6"
                            FontSize="{StaticResource FontSize.Caption}"/>
                    <Button Content="ðŸ“¤ Import" 
                            Command="{Binding ImportSelectedRequirementsCommand}" 
                            IsEnabled="{Binding HasExtractedRequirements}"
                            Style="{StaticResource ActionButton.Secondary}"
                            Margin="0,0,6,0" 
                            Padding="8,6"
                            FontSize="{StaticResource FontSize.Caption}"/>
                </StackPanel>
                -->
            </Grid>
        </Border>

        <!-- Results Tabs -->
        <TabControl Grid.Row="2" Margin="5">
            <TabControl.Resources>
                <Style TargetType="{x:Type TabItem}">
                    <Setter Property="Background" Value="{StaticResource Brush.Background.Header}"/>
                    <Setter Property="Foreground" Value="{StaticResource Brush.Accent.Primary}"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Padding" Value="12,8"/>
                    <Setter Property="FontSize" Value="{StaticResource FontSize.Body}"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border x:Name="Root"
                                        Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        CornerRadius="4,4,0,0"
                                        Padding="{TemplateBinding Padding}">
                                    <ContentPresenter x:Name="ContentSite"
                                                      ContentSource="Header"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <!-- Mouse over: subtle orange border -->
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="Root" Property="BorderBrush" Value="{StaticResource Brush.Border.Focus}"/>
                                    </Trigger>
                                    <!-- Selected state: orange border -->
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Root" Property="BorderBrush" Value="{StaticResource Brush.Border.Accent}"/>
                                        <Setter TargetName="Root" Property="Background" Value="{StaticResource Brush.Background.Pill.Selected}"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>
            <!-- Attachments Tab -->
            <TabItem Header="Found Attachments">
                <Grid>
                    <ListView ItemsSource="{Binding FoundAttachments}" 
                              SelectedItem="{Binding SelectedAttachment}"
                              SelectionMode="Single"
                              ScrollViewer.HorizontalScrollBarVisibility="Auto">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="ID" DisplayMemberBinding="{Binding Id}" Width="80"/>
                                <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="200"/>
                                <GridViewColumn Header="File Name" DisplayMemberBinding="{Binding FileName}" Width="150"/>
                                <GridViewColumn Header="Size" DisplayMemberBinding="{Binding Size}" Width="80"/>
                                <GridViewColumn Header="Created Date" DisplayMemberBinding="{Binding CreatedDate}" Width="120"/>
                                <GridViewColumn Header="Mime Type" DisplayMemberBinding="{Binding MimeType}" Width="120"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </TabItem>

            <!-- Parsing Results Tab -->
            <TabItem Header="Parsing Results">
                <Grid>
                    <ListBox ItemsSource="{Binding ParsingResults}"
                             ScrollViewer.HorizontalScrollBarVisibility="Auto"
                             ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" TextWrapping="Wrap" Margin="5"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </TabItem>

            <!-- Extracted Requirements Tab -->
            <TabItem Header="Extracted Requirements">
                <Grid>
                    <ListView ItemsSource="{Binding ExtractedRequirements}"
                              ScrollViewer.HorizontalScrollBarVisibility="Auto">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="ID" DisplayMemberBinding="{Binding Item}" Width="120"/>
                                <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="200"/>
                                <GridViewColumn Header="Description" DisplayMemberBinding="{Binding Description}" Width="350"/>
                                <GridViewColumn Header="Type" DisplayMemberBinding="{Binding ItemType}" Width="100"/>
                                <GridViewColumn Header="Project" DisplayMemberBinding="{Binding Project}" Width="150"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- No Jama Project Overlay -->
        <Border Grid.Row="0" Grid.RowSpan="3" 
                Background="#C0000000" 
                Visibility="{Binding HasJamaProject, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
            <Border Background="{StaticResource Brush.Background.Header}" 
                    BorderBrush="{StaticResource Brush.Border.Accent}"
                    BorderThickness="2"
                    CornerRadius="8"
                    Padding="32" 
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="ðŸ”— No Jama Project Associated" 
                               FontSize="{StaticResource FontSize.H1}" 
                               FontWeight="SemiBold" 
                               Foreground="{StaticResource Brush.Accent.Primary}"
                               HorizontalAlignment="Center" 
                               Margin="0,0,0,12"/>
                    <TextBlock Text="Document scraping requires a workspace with an associated Jama project." 
                               TextWrapping="Wrap" 
                               FontSize="{StaticResource FontSize.Body}"
                               Foreground="{StaticResource Brush.Text.Secondary}"
                               HorizontalAlignment="Center" 
                               MaxWidth="350" 
                               TextAlignment="Center"/>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</UserControl>