<UserControl x:Class="TestCaseEditorApp.MVVM.Views.RequirementDescriptionEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:TestCaseEditorApp.Converters">

    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/><!-- Header -->
            <RowDefinition Height="*"/>   <!-- Text Editor -->
            <RowDefinition Height="Auto"/><!-- Buttons -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="{DynamicResource MenuBackground}"
                BorderBrush="{DynamicResource AccentBrush}"
                BorderThickness="0,0,0,1"
                Padding="20,16">
            <TextBlock Text="{Binding WindowTitle}"
                       Foreground="White"
                       FontSize="16"
                       FontWeight="SemiBold"
                       HorizontalAlignment="Center"/>
        </Border>

        <!-- Text Editor -->
        <Border Grid.Row="1"
                Background="#2D2D30"
                BorderBrush="{DynamicResource AccentBrush}"
                BorderThickness="1"
                Margin="20,20,20,0">
            <TextBox Text="{Binding EditedDescription, UpdateSourceTrigger=PropertyChanged}"
                     TextWrapping="Wrap"
                     AcceptsReturn="True"
                     VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Disabled"
                     Foreground="White"
                     CaretBrush="{DynamicResource AccentBrush}"
                     Background="Transparent"
                     BorderThickness="0"
                     Padding="12"
                     FontSize="14"
                     FontFamily="Segoe UI"
                     MinHeight="200">
                <TextBox.Style>
                    <Style TargetType="TextBox">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TextBox">
                                    <ScrollViewer x:Name="PART_ContentHost"
                                                  Background="{TemplateBinding Background}"
                                                  BorderThickness="0"
                                                  IsTabStop="False"
                                                  VerticalScrollBarVisibility="{TemplateBinding VerticalScrollBarVisibility}"
                                                  HorizontalScrollBarVisibility="{TemplateBinding HorizontalScrollBarVisibility}"/>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TextBox.Style>
            </TextBox>
        </Border>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" Margin="20,20,20,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Inspect Prompt button (left side) -->
            <Button Grid.Column="0"
                    Command="{Binding InspectPromptCommand}"
                    HorizontalAlignment="Left"
                    Padding="12,8"
                    MinWidth="100">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource SecondaryButton}">
                        <Setter Property="Content" Value="Inspect Prompt"/>
                    </Style>
                </Button.Style>
            </Button>

            <!-- Re-Analyze button -->
            <Button Grid.Column="1"
                    Command="{Binding ReAnalyzeCommand}"
                    Margin="0,0,12,0"
                    Padding="12,8"
                    MinWidth="100"
                    IsEnabled="{Binding IsAnalyzing, Converter={StaticResource BoolToInvertedBoolConverter}}">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
                        <Setter Property="Content" Value="Re-Analyze"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsAnalyzing}" Value="True">
                                <Setter Property="Content" Value="Analyzing..."/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- Save button -->
            <Button Grid.Column="2"
                    Command="{Binding SaveCommand}"
                    Margin="0,0,12,0"
                    Padding="16,8"
                    MinWidth="80">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
                        <Setter Property="Content" Value="Save"/>
                    </Style>
                </Button.Style>
            </Button>

            <!-- Cancel button -->
            <Button Grid.Column="3"
                    Command="{Binding CancelCommand}"
                    Padding="16,8"
                    MinWidth="80">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource SecondaryButton}">
                        <Setter Property="Content" Value="Cancel"/>
                    </Style>
                </Button.Style>
            </Button>
        </Grid>

        <!-- Analysis Overlay -->
        <Grid Grid.RowSpan="3"
              Background="#99000000"
              Visibility="{Binding IsAnalyzing, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="â—" 
                           FontSize="48" 
                           Foreground="{DynamicResource AccentBrush}"
                           HorizontalAlignment="Center"
                           RenderTransformOrigin="0.5,0.5">
                    <TextBlock.RenderTransform>
                        <RotateTransform x:Name="SpinTransform"/>
                    </TextBlock.RenderTransform>
                    <TextBlock.Triggers>
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever">
                                    <DoubleAnimation Storyboard.TargetName="SpinTransform"
                                                   Storyboard.TargetProperty="Angle"
                                                   From="0" To="360" Duration="0:0:2"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </TextBlock.Triggers>
                </TextBlock>
                <TextBlock Text="Analyzing requirement..."
                           Foreground="White"
                           FontSize="14"
                           Margin="0,16,0,0"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>