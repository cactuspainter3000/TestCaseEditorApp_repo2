<UserControl x:Class="TestCaseEditorApp.MVVM.Views.SideMenuView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:conv="clr-namespace:TestCaseEditorApp.Converters"
             xmlns:vm="clr-namespace:TestCaseEditorApp.MVVM.ViewModels"
             xmlns:controls="clr-namespace:TestCaseEditorApp.MVVM.Controls"
             d:DataContext="{d:DesignInstance Type=vm:SideMenuViewModel, IsDesignTimeCreatable=False}"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="200">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/TestCaseEditorApp;component/Resources/DesignSystem.xaml"/>
                <ResourceDictionary Source="/TestCaseEditorApp;component/Resources/Base/Typography.xaml"/>
                <ResourceDictionary Source="/TestCaseEditorApp;component/Resources/Controls/Button.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <conv:SectionSelectedConverter x:Key="SectionSelectedConverter" />
            <BooleanToVisibilityConverter x:Key="BoolToVis" />
        </ResourceDictionary>
    </UserControl.Resources>

    <Border Background="{StaticResource Brush.Background.Menu}" 
            BorderBrush="{StaticResource Brush.Border.Default}" 
            BorderThickness="1" 
            CornerRadius="{StaticResource Radius.SM}">
        <controls:HierarchicalMenuControl MenuItems="{Binding HierarchicalMenuItems}"/>
            <StackPanel>

                <!-- Test Case Generator -->
                <ToggleButton x:Name="TestCaseGeneratorToggle"
                              Content="Test Case Generator"
                              Style="{StaticResource ToggleButton.Primary}"
                              HorizontalAlignment="Stretch"
                              IsChecked="{Binding SelectedMenuSection, Converter={StaticResource SectionSelectedConverter}, ConverterParameter=TestCase, Mode=TwoWay}"/>

                <StackPanel Visibility="{Binding IsChecked, ElementName=TestCaseGeneratorToggle, Converter={StaticResource BoolToVis}}">
                    
                    <!-- Project -->
                    <TextBlock Text="Project" Style="{StaticResource Text.Header.Secondary}" Margin="20,10,0,0"/>
                    <Button Command="{Binding NewProjectCommand}" Content="📁 New Project" Style="{StaticResource Button.Primary}" Margin="40,5,0,0"/>
                    <Button Command="{Binding QuickImportCommand}" Content="⚡ Quick Import (Legacy)" Style="{StaticResource Button.Primary}" Margin="40,5,0,0"/>
                    <Button Command="{Binding OpenProjectCommand}" Content="📂 Open Project" Style="{StaticResource Button.Primary}" Margin="40,5,0,0"/>
                    <Button Command="{Binding SaveProjectCommand}" Content="💾 Save Project" Style="{StaticResource Button.Primary}" Margin="40,5,0,0"/>
                    <Button Command="{Binding CloseProjectCommand}" Content="❌ Close Project" Style="{StaticResource Button.Primary}" Margin="40,5,0,0"/>
                    
                    <!-- Requirement -->
                    <TextBlock Text="Requirement" Style="{StaticResource Text.Header.Secondary}" Margin="20,10,0,0"/>
                    <Button Command="{Binding ImportAdditionalCommand}" Content="📥 Import Additional Requirements" Style="{StaticResource Button.Primary}" Margin="40,5,0,0"/>
                    
                    <!-- Analysis -->
                    <TextBlock Text="Analysis" Style="{StaticResource Text.Header.Tertiary}" Margin="40,10,0,0"/>
                    <Button Command="{Binding BatchAnalyzeCommand}" Content="⚡ Analyze All Requirements" Style="{StaticResource Button.Secondary}" Margin="60,5,0,0"/>
                    <Button Command="{Binding AnalyzeUnanalyzedCommand}" Content="🔍 Analyze Unanalyzed" Style="{StaticResource Button.Secondary}" Margin="60,5,0,0"/>
                    <Button Command="{Binding ExportForChatGptCommand}" Content="📝 Export for ChatGPT" Style="{StaticResource Button.Secondary}" Margin="60,5,0,0"/>
                    
                    <!-- Questions -->
                    <TextBlock Text="Clarifying Questions" Style="{StaticResource Text.Header.Tertiary}" Margin="40,10,0,0"/>
                    <Button Content="❓ Ask Questions" Style="{StaticResource Button.Secondary}" Margin="60,5,0,0"/>
                    <Button Content="📋 Paste from Clipboard" Style="{StaticResource Button.Secondary}" Margin="60,5,0,0"/>
                    <Button Content="🔄 Regenerate Questions" Style="{StaticResource Button.Secondary}" Margin="60,5,0,0"/>
                    
                    <!-- Verification Method Assumptions -->
                    <TextBlock Text="Verification Method Assumptions" Style="{StaticResource Text.Header.Tertiary}" Margin="40,10,0,0"/>
                    <Button Content="🔄 Reset All Assumptions" Style="{StaticResource Button.Secondary}" Margin="60,5,0,0"/>
                    <Button Content="🧹 Clear Preset Filter" Style="{StaticResource Button.Secondary}" Margin="60,5,0,0"/>
                    
                    <!-- Other items -->
                    <TextBlock Text="LLM Learning" Style="{StaticResource Text.Header.Secondary}" Margin="20,5,0,0"/>
                    <TextBlock Text="Test Case Generator" Style="{StaticResource Text.Header.Secondary}" Margin="20,5,0,0"/>
                </StackPanel>

                <!-- Test Flow Generator -->
                <ToggleButton x:Name="TestFlowGeneratorToggle"
                              Content="Test Flow Generator"
                              Style="{StaticResource ToggleButton.Primary}"
                              HorizontalAlignment="Stretch"
                              Margin="0,10,0,0"
                              IsChecked="{Binding SelectedMenuSection, Converter={StaticResource SectionSelectedConverter}, ConverterParameter=TestFlow, Mode=TwoWay}"/>

                <StackPanel Visibility="{Binding IsChecked, ElementName=TestFlowGeneratorToggle, Converter={StaticResource BoolToVis}}">
                    
                    <!-- Test Flow Steps -->
                    <ListBox ItemsSource="{Binding TestFlowSteps}"
                             SelectedItem="{Binding SelectedStep, Mode=TwoWay}"
                             Background="Transparent"
                             BorderThickness="0"
                             Margin="20,10,0,0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="{Binding DisplayName}"/>
                                    <TextBlock Text="{Binding Badge}" Foreground="Orange"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    
                    <!-- Testing -->
                    <ToggleButton x:Name="TestingDropdownToggle"
                                  Content="Testing"
                                  Style="{StaticResource ToggleButton.Primary}"
                                  HorizontalAlignment="Stretch"
                                  Margin="20,10,0,0"/>
                    
                    <StackPanel Visibility="{Binding IsChecked, ElementName=TestingDropdownToggle, Converter={StaticResource BoolToVis}}" Margin="40,0,0,0">
                        <Button Content="Test Option 1" Style="{StaticResource Button.Secondary}" Margin="0,5,0,0"/>
                        <Button Content="Test Option 2" Style="{StaticResource Button.Secondary}" Margin="0,5,0,0"/>
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>

        <TextBlock Grid.Row="1"
                   VerticalAlignment="Bottom"
                   Text="{Binding SapStatus}"
                   HorizontalAlignment="Center"
                   Foreground="{StaticResource Brush.Text.Secondary}"
                   Style="{StaticResource MenuItemTextStyle}"
                   Margin="0,10,0,5"/>
        </Grid>
    </Border>
</UserControl>