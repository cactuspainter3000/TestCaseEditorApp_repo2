<UserControl x:Class="TestCaseEditorApp.MVVM.Views.RequirementsParagraphsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:TestCaseEditorApp.MVVM.ViewModels"
             MinHeight="200">

    <UserControl.Resources>
        <!-- Local converter so the toolbar Visibility binding always resolves,
             even if the app-level converter isn't merged into this control. -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- local toolbar (can be hidden by parent) -->
            <RowDefinition Height="*"/>
            <!-- content -->
        </Grid.RowDefinitions>

        <!-- Local toolbar: visibility bound to ShowLocalToolbar DP on the UserControl -->
        <DockPanel Grid.Row="0" LastChildFill="False" Margin="0,0,0,8"
                   Visibility="{Binding ShowLocalToolbar, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right">
                <!-- Standalone control commands (keep names consistent with your child-viewmodel usage) -->
                <Button Content="Select all" Command="{Binding SelectAllParagraphsCommand}" Margin="0,0,6,0"/>
                <Button Content="Clear all" Command="{Binding ClearAllParagraphsCommand}" />
            </StackPanel>
        </DockPanel>

        <!-- Paragraph list -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <ItemsControl ItemsSource="{Binding SelectedParagraphVMs}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type vm:ParagraphViewModel}">
                        <Border Padding="6" Margin="0,0,0,6">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="{Binding Text}" TextWrapping="Wrap"/>

                                <!-- per-paragraph include checkbox -->
                                <CheckBox Grid.Column="1" IsChecked="{Binding IncludeInPrompt}" VerticalAlignment="Top" Margin="8,0,0,0" ToolTip="Include this paragraph in the prompt"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>