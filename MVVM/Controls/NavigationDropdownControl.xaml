<UserControl x:Class="TestCaseEditorApp.MVVM.Controls.NavigationDropdownControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid>
        <!-- Custom Dropdown using ActionToggleButton + Popup (reusable pattern) -->
        <ToggleButton x:Name="DropdownButton"
                     Style="{StaticResource ActionToggleButton}"
                     IsChecked="{Binding IsDropdownOpen, RelativeSource={RelativeSource AncestorType=UserControl}}"
                     HorizontalAlignment="Stretch"
                     HorizontalContentAlignment="Stretch"
                     FontWeight="Normal"
                     Padding="6,5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="24"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                          FontSize="12"
                          VerticalAlignment="Center"
                          TextTrimming="CharacterEllipsis">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Text" Value="{Binding SelectedItemDisplayText, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="{x:Null}">
                                    <Setter Property="Text" Value="{Binding EmptyText, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                                    <Setter Property="Foreground" Value="{StaticResource Brush.Text.Secondary}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                
                <TextBlock Grid.Column="1" 
                          Text="â–¼"
                          FontSize="12" 
                          VerticalAlignment="Center"
                          HorizontalAlignment="Right"
                          Margin="0,0,4,0">
                    <TextBlock.RenderTransform>
                        <RotateTransform Angle="0"/>
                    </TextBlock.RenderTransform>
                    <TextBlock.RenderTransformOrigin>0.5,0.5</TextBlock.RenderTransformOrigin>
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsDropdownOpen, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                               To="180" Duration="0:0:0.3"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                               To="0" Duration="0:0:0.3"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Grid>
        </ToggleButton>
        
        <!-- Popup for dropdown content -->
        <Popup IsOpen="{Binding IsDropdownOpen, RelativeSource={RelativeSource AncestorType=UserControl}}"
               PlacementTarget="{Binding ElementName=DropdownButton}"
               Placement="Bottom"
               AllowsTransparency="True"
               PopupAnimation="Slide"
               StaysOpen="False"
               Focusable="False">
            <Border Background="{StaticResource Brush.Background.Menu}"
                    BorderBrush="{StaticResource Brush.Border.Subtle}"
                    BorderThickness="1"
                    CornerRadius="4"
                    MaxHeight="400"
                    MinWidth="{Binding ElementName=DropdownButton, Path=ActualWidth}">
                <Border.Effect>
                    <DropShadowEffect Color="Black" 
                                     Direction="315" 
                                     ShadowDepth="3" 
                                     Opacity="0.3"
                                     BlurRadius="8"/>
                </Border.Effect>
                
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Disabled"
                             MaxHeight="350">
                    <ScrollViewer.Resources>
                        <Style TargetType="ScrollBar" BasedOn="{StaticResource CustomScrollBarStyle}"/>
                    </ScrollViewer.Resources>
                    
                    <ItemsControl ItemsSource="{Binding ItemsSource, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                 Margin="4">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Style="{StaticResource SideMenuPopupButtonStyle}"
                                        Command="{Binding SelectItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Margin="0,1"
                                        Padding="6,5"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left">
                                    
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ“Ž" 
                                                  FontSize="12" 
                                                  Margin="0,0,6,0"
                                                  VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding DisplayName}" 
                                                  FontSize="12"
                                                  TextWrapping="Wrap"
                                                  VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>
        </Popup>
    </Grid>
</UserControl>